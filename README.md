# Courier Service — Микросервис управления курьерами

Учебный backend-проект на Go, реализующий микросервис для управления курьерами, их заказами и состоянием доставки.  
Сервис предоставляет REST API, работает с PostgreSQL и взаимодействует с другими сервисами асинхронно через Kafka и синхронно через gRPC. Поддерживается конкурентная обработка задач, интеграционные тесты, мониторинг и контейнеризация.

---

## Функциональность

- Регистрация и управление курьерами
- Назначение и обработка заказов
- Изменение статусов доставки
- Асинхронное межсервисное взаимодействие через Kafka
- Синхронное взаимодействие через gRPC
- Ограничение нагрузки (rate limiter)
- Метрики и мониторинг

---

# Технологический стек

## Go, PostgreSQL, gRPC, Kafka, Docker, Prometheus, Grafana

---

## HTTP и API

- `net/http` — базовый HTTP-сервер
- `chi` — маршрутизация и управление middleware
- REST-архитектура
- Группировка роутов и версионирование API
- Middleware-цепочки (логирование, rate limiting, recovery)


---

## Межсервисное взаимодействие

### Apache Kafka (асинхронная модель)

- Консьюмеры для обработки сообщений
- Идемпотентная обработка событий

### gRPC (синхронная модель)

- gRPC-клиент для вызова внешнего сервиса

Использование двух моделей взаимодействия позволяет:

- обрабатывать события асинхронно (Kafka)
- выполнять критичные запросы синхронно (gRPC)
- снижать связанность сервисов
- управлять отказоустойчивостью

---

## Архитектура

Проект построен по принципам чистой архитектуры.

### Структурное разделение:

- `internal/`:
    - `adapters`
    - `config`
    - `domain` — доменные модели
    - `gateway`
    - `handler` — слой контроллеров
    - `observability`
    - `repository` — слой репозитория
    - `service` - слой сервиса
    - `worker`

### Принципы:

- Разделение слоев (handler → service → repository → infrastructure)
- Dependency inversion
- Интерфейсы для абстракции
- Минимизация связности
- Graceful Shutdown для HTTP, Kafka consumers и gRPC соединений

---

## База данных

- **PostgreSQL**
- `pgx / pgs`
- Миграции через **goose**
- Транзакции
- Индексы

---

## Конкурентность

- Горутины
- Каналы
- Параллельные Kafka consumers
- Управление пулом gRPC-соединений

---

## Паттерны

- Factory
- Unit of Work
- Decorator
- Rate Limiter

---

## Тестирование

### Unit-тесты

```bash
make run_tests
```

С покрытием:
```bash
make run_tests_with_coverage
```

### Интеграционные тесты

```bash
make make run_test_integration
```

## Observability
- Метрики
- Базовый мониторинг
- Логирование
- Профилирование

## Ограничение нагрузки
- Реализация rate limiter
- Контроль частоты запросов

## Docker и CI/CD
- Dockerfile
- Docker Compose
- Контейнеризация приложения и БД
- Сборка и запуск через Makefile
- Подготовка к CI/CD пайплайну

# Запуск

## Требования

- Docker
- Docker Compose
- Make
- Go (для локального запуска и тестов)

> В корневой директории проекта должен находиться каталог `service-order`.  
> Он не хранится в репозитории и должен быть добавлен вручную.

---

## Production-запуск

Поднимает сервис вместе с инфраструктурой (БД и прочие зависимости):

```bash
make up_prod
